<!DOCTYPE html>
<html lang="en">

    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><title>Quirks of x86 OSDev &ndash; aaban akhtar</title>
<meta name="description" content="Sophomore at North Wake College and Career Academy. I&#39;m passionate about robotics, systems programming, and building impactful tech projects. This site showcases my work, ideas, and journey.">

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="UTF-8"/>



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.4/css/academicons.min.css" integrity="sha512-IW0nhlW5MgNydsXJO40En2EoCkTTjZhI3yuODrZIc8cQ4h1XcF53PsqDHa09NqnkXuIe0Oiyyj171BqZFwISBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />


<link rel="stylesheet" href="http://localhost:1313/css/palettes/gruvbox-dark.css">
<link rel="stylesheet" href="http://localhost:1313/css/risotto.css">
<link rel="stylesheet" href="http://localhost:1313/css/custom.css">












<meta property="og:title" content="Quirks of x86 OSDev &ndash; aaban akhtar" />
<meta property="og:url" content="http://localhost:1313/posts/x86_quirks/" />

  <meta property="og:description" content="x86 programming has a lot of backwards compatibility that can be quite interesting &ndash; "/> 

<meta property="og:locale" content="en" />
<meta property="og:image" content="" /></head>

    <body>
        <div class="page">

            <header class="page__header"><nav class="page__nav main-nav">
    <ul>
      <li class="nomarker"><h1 class="page__logo"><a href="http://localhost:1313/" class="page__logo-inner">aaban akhtar</a></h1></li>
    
    
    <li class="main-nav__item"><a class="nav-main-item active" href="http://localhost:1313/posts/" title="Posts">Posts</a></li>
    
    </ul>
</nav>

</header>

            <section class="page__body">
    <header class="content__header">
        <h1>Quirks of x86 OSDev</h1>
    </header>
    <div class="content__body">
        <p>I&rsquo;m writing an operating system called &ldquo;Twig&rdquo;, and it&rsquo;s been quite the fun experience. However, there has been quite a bit of friction between my codebase and the x86 architecture. The amount of code needed for backwards
compatiblity reasons is suprising and is kind of annoying as well.</p>
<h1 id="the-8086">The 8086</h1>
<p>x86, which is the architecture that most modern computers use, is based on the design of the Intel 8086, a chip from the <strong>1970s</strong>. Additionally, the original 8086 was 16 bit, which plays an interesting role in OSDev (which we&rsquo;ll get into later). The fact that we have dragged this architecture so far presents some interesting design choices for OS Developers, some of which I have learned about while writing Twig.</p>
<h1 id="modes">Modes</h1>
<p>Modern cpus are 64 bit, but the 8086 was 16 bit. This means that by default, in order to maintain backwards compatibility, there are different &ldquo;modes&rdquo; in which your computer operates. The default is <em>Real mode</em>, which means that your cpu generally boots up as a 16 bit chip.</p>
<p>Obviously, this isn&rsquo;t good, becuase it restricts your access to memory, and other peripherals too. As a result, you have to jump to either 32 bit or 64 bit (protected/long mode) either through manual bootloading code, or through something like GRUB (which is what I used).</p>
<h1 id="the-gdt">The GDT</h1>
<p>The Global Descriptor Table basically partitions the memory into protected areas and is largely a legacy feature that isn&rsquo;t really used in modern OSes (except for Task State stuff). The code for creating this &ldquo;GDT&rdquo; is quite verbose and is difficult to build intuition behind (for me, personally, at least.) It would be <em>great</em> if you could avoid it altogether, but the x86 architecture requires a GDT for basically anything related to interrupts or memory.</p>
<p>The GDT basically has all these segments that are protected based on your selectors and whatnot. However, most modern oses just make these segments span the entire length of the memory, and prefer to use modern techniques like paging instead. So much code for just backwards compatiblity is quite the fun time.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    setGDTEntry(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>); <span style="color:#75715e">// null descriptor
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    setGDTEntry(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0x9A</span>, <span style="color:#ae81ff">0xC</span>, <span style="color:#ae81ff">0xFFFFFFFF</span>); <span style="color:#75715e">// Kernel mode code segment
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    setGDTEntry(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0x92</span>, <span style="color:#ae81ff">0xC</span>, <span style="color:#ae81ff">0xFFFFFFFF</span>); <span style="color:#75715e">// Kernel mode data segment 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    setGDTEntry(<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0xFA</span>, <span style="color:#ae81ff">0xC</span>, <span style="color:#ae81ff">0xFFFFFFFF</span>); <span style="color:#75715e">// Userspace code segment ring 3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    setGDTEntry(<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0xF2</span>, <span style="color:#ae81ff">0xC</span>, <span style="color:#ae81ff">0xFFFFFFFF</span>); <span style="color:#75715e">// Userspace Data segment ring 3
</span></span></span></code></pre></div>
<style>
.canon { background: white; width: 100%; height: auto; }
</style>


    </div>
    <footer class="content__footer"></footer>

            </section>

            <section class="page__aside">
                <div class="aside__about">
<div class="aside__about">
    <span class="about__logo" role="img">ðŸ‘‹</span>&nbsp;
    
<h1 class="about__title">About Me</h1>
<p class="about__description">Sophomore at North Wake College and Career Academy. I&rsquo;m passionate about robotics, systems programming, and building impactful tech projects. This site showcases my work, ideas, and journey.</p>
</div>


<ul class="aside__social-links">
    
    <li>
        <a href="https://github.com/aabanakhtar-github" rel="me" aria-label="GitHub" title="GitHub"><i class="fa-brands fa-github" aria-hidden="true"></i></a>&nbsp;
    </li>
    
    <li>
        <a href="mailto:aabanakhtar.home@gmail.com" rel="me" aria-label="Email" title="Email"><i class="fa-solid fa-envelope" aria-hidden="true"></i></a>&nbsp;
    </li>
    
    <li>
        <a href="https://orcid.org/0000-0001-2345-6789" rel="me" aria-label="ORCID" title="ORCID"><i class="ai ai-orcid" aria-hidden="true"></i></a>&nbsp;
    </li>
    
</ul>
</div>
                <hr>
                <div class="aside__content">
    <p>x86 programming has a lot of backwards compatibility that can be quite interesting</p>
    
        <p>
            By Aaban Akhtar, 
            2025-06-17
        </p>
    

    

                </div>
            </section>

            <footer class="page__footer"><p>
    
    
    
    
    
    
      
    
    
    
      
      
          
            
            

            
          
      
    
</p>
<br /><br />
<p class="copyright">Â© <a href="aabanakhtar.github.io">Aaban Akhtar</a></p>
</footer>

        </div>
    </body>

</html>
